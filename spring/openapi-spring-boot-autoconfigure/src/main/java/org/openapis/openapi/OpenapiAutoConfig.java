/* 
 * Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.
 */
package org.openapis.openapi;

import org.springframework.boot.autoconfigure.AutoConfiguration;
import org.springframework.boot.autoconfigure.condition.ConditionalOnClass;
import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;
import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;
import org.springframework.boot.context.properties.EnableConfigurationProperties;
import org.springframework.context.annotation.Bean;
import java.util.concurrent.TimeUnit;

import java.lang.IllegalStateException;
import java.util.Optional;
import java.util.concurrent.Executors;
import java.util.concurrent.ScheduledExecutorService;
import org.openapis.openapi.utils.BackoffStrategy;
import org.openapis.openapi.utils.HTTPClient;
import org.openapis.openapi.utils.RetryConfig;
import org.openapis.openapi.utils.SpeakeasyHTTPClient;


/**
 * Spring Boot Auto Configuration for openapi SDK
 * This configuration class automatically configures the openapi SDK
 * when Spring Boot detects it on the classpath.
 */
@AutoConfiguration
@ConditionalOnClass(Novu.class)
@EnableConfigurationProperties(OpenapiAutoConfigProperties.class)
public class OpenapiAutoConfig {

    /**
     * Constructor.
     */
    public OpenapiAutoConfig() {
    }

    /**
     * Creates a RetryConfig bean from properties if retry is enabled.
     * 
     * @param properties the configuration properties
     * @return A configured RetryConfig instance
     */
    @Bean
    @ConditionalOnMissingBean
    @ConditionalOnProperty(prefix = "openapi.retry-config", name = "strategy")
    public RetryConfig retryConfig(OpenapiAutoConfigProperties properties) {
        OpenapiAutoConfigProperties.RetryConfig retryProps = properties.getRetryConfig();
        
        if (RetryConfig.Strategy.BACKOFF.equals(retryProps.getStrategy())) {
            OpenapiAutoConfigProperties.RetryConfig.Backoff backoff = retryProps.getBackoff();
            return RetryConfig.builder()
                .backoff(
                    BackoffStrategy.builder()
                        .initialInterval(backoff.getInitialInterval().toMillis(), TimeUnit.MILLISECONDS)
                        .maxInterval(backoff.getMaxInterval().toMillis(), TimeUnit.MILLISECONDS)
                        .maxElapsedTime(backoff.getMaxElapsedTime().toMillis(), TimeUnit.MILLISECONDS)
                        .baseFactor(backoff.getBaseFactor())
                        .jitterFactor(backoff.getJitterFactor())
                        .retryConnectError(backoff.isRetryConnectError())
                        .retryReadTimeoutError(backoff.isRetryReadTimeoutError())
                        .build()
                )
                .build();
        }
        
        // Default retry config for other strategies
        return RetryConfig.builder().build();
    }
    /**
     * Creates an HTTPClient bean if none exists.
     *
     * @param properties the configuration properties
     * @return A configured HTTPClient instance
     */
    @Bean
    @ConditionalOnMissingBean
    public HTTPClient httpClient(OpenapiAutoConfigProperties properties) {
        OpenapiAutoConfigProperties.HttpClient httpClientProps = properties.getHttpClient();

        if (httpClientProps != null) {
            // Configure debug logging
            SpeakeasyHTTPClient.setDebugLogging(httpClientProps.isEnableDebugLogging());

            // Configure redacted headers
            if (httpClientProps.getRedactedHeaders() != null && !httpClientProps.getRedactedHeaders().isEmpty()) {
                SpeakeasyHTTPClient.setRedactedHeaders(httpClientProps.getRedactedHeaders());
            }
        }

        return new SpeakeasyHTTPClient();
    }
    /**
     * Creates a SecuritySource bean if none exists and security properties are configured.
     *
     * @param properties the configuration properties
     * @return A configured SecuritySource instance
     */
    @Bean
    @ConditionalOnMissingBean
    @ConditionalOnPropertyPrefix(prefix = "openapi.security")
    public SecuritySource securitySource(OpenapiAutoConfigProperties properties) {OpenapiAutoConfigProperties.Security securityProps = properties.getSecurity();
        org.openapis.openapi.models.components.Security.Builder securityBuilder = org.openapis.openapi.models.components.Security.builder();
        boolean hasAnySecurityConfiguration = false;
        // Build secretKey security from direct properties (primitive value)
        if (securityProps.getSecretKey() != null) {
            securityBuilder.secretKey(securityProps.getSecretKey());
            hasAnySecurityConfiguration = true;
        }
        
        if (!hasAnySecurityConfiguration) {
            throw new IllegalStateException("Security configuration is present but no security options are configured. " +
                "Please configure at least one security option in your application properties.");
        }
        
        return SecuritySource.of(securityBuilder.build());
    }

    /**
     * Creates the SDKConfiguration bean as the single source of truth for all SDK configuration.
     *
     * @param properties the configuration properties
     * @param httpClient the HTTP client bean
     * @param hooks the hooks bean
     * @param asyncHooks the async hooks bean
     * @param securitySource the security source bean (optional)
     * @param retryConfig the retry config bean (optional)
     * @return A configured SDKConfiguration instance
     */
    @Bean
    @ConditionalOnMissingBean
    public SDKConfiguration sdkConfiguration(
            OpenapiAutoConfigProperties properties,
            HTTPClient httpClient,
            org.openapis.openapi.utils.Hooks hooks,
            org.openapis.openapi.utils.AsyncHooks asyncHooks,
            SecuritySource securitySource,
            Optional<RetryConfig> retryConfig) {
        
        SDKConfiguration sdkConfiguration = new SDKConfiguration();
        
        sdkConfiguration.setClient(httpClient);
        
        sdkConfiguration.setHooks(hooks);
        sdkConfiguration.setAsyncHooks(asyncHooks);
        sdkConfiguration.setSecuritySource(securitySource);
        
        if (properties.getServerUrl() != null) {
            sdkConfiguration.setServerUrl(properties.getServerUrl());
        }
        sdkConfiguration.setServerIdx(properties.getServerIdx());
        
        sdkConfiguration.setRetryConfig(retryConfig);
        
        return sdkConfiguration;
    }

    /**
     * Creates the main SDK bean using the configured SDKConfiguration.
     *
     * @param sdkConfiguration the configured SDKConfiguration bean
     * @return A configured Novu instance
     */
    @Bean
    @ConditionalOnMissingBean
    public Novu novu(SDKConfiguration sdkConfiguration) {
        return new Novu(sdkConfiguration);
    }

    /**
     * Creates an AsyncHooks bean if none exists.
     * 
     * @return A configured AsyncHooks instance
     */
    @Bean
    @ConditionalOnMissingBean
    public org.openapis.openapi.utils.AsyncHooks asyncHooks() {
        return new org.openapis.openapi.utils.AsyncHooks();
    }

    /**
     * Creates a ScheduledExecutorService for async retry operations if none exists.
     * 
     * @return A configured ScheduledExecutorService instance
     */
    @Bean
    @ConditionalOnMissingBean
    public ScheduledExecutorService retryScheduler() {
        return Executors.newSingleThreadScheduledExecutor();
    }

    /**
     * Creates a Hooks configuration bean if none exists.
     *
     * @return A configured Hooks instance
     */
    @Bean
    @ConditionalOnMissingBean
    public org.openapis.openapi.utils.Hooks hooks() {
        return new org.openapis.openapi.utils.Hooks();
    }
    /**
     * Creates a Contexts sub-SDK bean if none exists.
     *
     * @param novu the main SDK instance
     * @return A configured Contexts instance
     */
    @Bean
    @ConditionalOnMissingBean
    public Contexts contexts(Novu novu) {
        return novu.contexts();
    }
    /**
     * Creates a Environments sub-SDK bean if none exists.
     *
     * @param novu the main SDK instance
     * @return A configured Environments instance
     */
    @Bean
    @ConditionalOnMissingBean
    public Environments environments(Novu novu) {
        return novu.environments();
    }
    /**
     * Creates a Activity sub-SDK bean if none exists.
     *
     * @param novu the main SDK instance
     * @return A configured Activity instance
     */
    @Bean
    @ConditionalOnMissingBean
    public Activity activity(Novu novu) {
        return novu.activity();
    }
    /**
     * Creates a Layouts sub-SDK bean if none exists.
     *
     * @param novu the main SDK instance
     * @return A configured Layouts instance
     */
    @Bean
    @ConditionalOnMissingBean
    public Layouts layouts(Novu novu) {
        return novu.layouts();
    }
    /**
     * Creates a Subscribers sub-SDK bean if none exists.
     *
     * @param novu the main SDK instance
     * @return A configured Subscribers instance
     */
    @Bean
    @ConditionalOnMissingBean
    public Subscribers subscribers(Novu novu) {
        return novu.subscribers();
    }
    /**
     * Creates a SubscribersPreferences sub-SDK bean if none exists.
     *
     * @param novu the main SDK instance
     * @return A configured SubscribersPreferences instance
     */
    @Bean
    @ConditionalOnMissingBean
    public SubscribersPreferences subscribersPreferences(Novu novu) {
        return novu.subscribersPreferences();
    }
    /**
     * Creates a Topics sub-SDK bean if none exists.
     *
     * @param novu the main SDK instance
     * @return A configured Topics instance
     */
    @Bean
    @ConditionalOnMissingBean
    public Topics topics(Novu novu) {
        return novu.topics();
    }
    /**
     * Creates a TopicsSubscriptions sub-SDK bean if none exists.
     *
     * @param novu the main SDK instance
     * @return A configured TopicsSubscriptions instance
     */
    @Bean
    @ConditionalOnMissingBean
    public TopicsSubscriptions topicsSubscriptions(Novu novu) {
        return novu.topicsSubscriptions();
    }
    /**
     * Creates a Translations sub-SDK bean if none exists.
     *
     * @param novu the main SDK instance
     * @return A configured Translations instance
     */
    @Bean
    @ConditionalOnMissingBean
    public Translations translations(Novu novu) {
        return novu.translations();
    }
    /**
     * Creates a TranslationsMaster sub-SDK bean if none exists.
     *
     * @param novu the main SDK instance
     * @return A configured TranslationsMaster instance
     */
    @Bean
    @ConditionalOnMissingBean
    public TranslationsMaster translationsMaster(Novu novu) {
        return novu.translationsMaster();
    }
    /**
     * Creates a Workflows sub-SDK bean if none exists.
     *
     * @param novu the main SDK instance
     * @return A configured Workflows instance
     */
    @Bean
    @ConditionalOnMissingBean
    public Workflows workflows(Novu novu) {
        return novu.workflows();
    }
    /**
     * Creates a ChannelConnections sub-SDK bean if none exists.
     *
     * @param novu the main SDK instance
     * @return A configured ChannelConnections instance
     */
    @Bean
    @ConditionalOnMissingBean
    public ChannelConnections channelConnections(Novu novu) {
        return novu.channelConnections();
    }
    /**
     * Creates a ChannelEndpoints sub-SDK bean if none exists.
     *
     * @param novu the main SDK instance
     * @return A configured ChannelEndpoints instance
     */
    @Bean
    @ConditionalOnMissingBean
    public ChannelEndpoints channelEndpoints(Novu novu) {
        return novu.channelEndpoints();
    }
    /**
     * Creates a Integrations sub-SDK bean if none exists.
     *
     * @param novu the main SDK instance
     * @return A configured Integrations instance
     */
    @Bean
    @ConditionalOnMissingBean
    public Integrations integrations(Novu novu) {
        return novu.integrations();
    }
    /**
     * Creates a Messages sub-SDK bean if none exists.
     *
     * @param novu the main SDK instance
     * @return A configured Messages instance
     */
    @Bean
    @ConditionalOnMissingBean
    public Messages messages(Novu novu) {
        return novu.messages();
    }
    /**
     * Creates a Notifications sub-SDK bean if none exists.
     *
     * @param novu the main SDK instance
     * @return A configured Notifications instance
     */
    @Bean
    @ConditionalOnMissingBean
    public Notifications notifications(Novu novu) {
        return novu.notifications();
    }
    /**
     * Creates a SubscribersMessages1 sub-SDK bean if none exists.
     *
     * @param novu the main SDK instance
     * @return A configured SubscribersMessages1 instance
     */
    @Bean
    @ConditionalOnMissingBean
    public SubscribersMessages1 subscribersMessages(Novu novu) {
        return novu.subscribersMessages();
    }
    /**
     * Creates a SubscribersNotifications sub-SDK bean if none exists.
     *
     * @param novu the main SDK instance
     * @return A configured SubscribersNotifications instance
     */
    @Bean
    @ConditionalOnMissingBean
    public SubscribersNotifications subscribersNotifications(Novu novu) {
        return novu.subscribersNotifications();
    }

    /**
     * Creates the async SDK bean if none exists.
     *
     * @param novu the main SDK instance
     * @param sdkConfiguration the configured SDKConfiguration bean
     * @return A configured AsyncNovu instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncNovu asyncNovu(Novu novu, SDKConfiguration sdkConfiguration) {
        return new AsyncNovu(novu, sdkConfiguration);
    }
    /**
     * Creates an AsyncContexts sub-SDK bean if none exists.
     *
     * @param asyncNovu the async SDK instance
     * @return A configured AsyncContexts instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncContexts asyncContexts(AsyncNovu asyncNovu) {
        return asyncNovu.contexts();
    }
    /**
     * Creates an AsyncEnvironments sub-SDK bean if none exists.
     *
     * @param asyncNovu the async SDK instance
     * @return A configured AsyncEnvironments instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncEnvironments asyncEnvironments(AsyncNovu asyncNovu) {
        return asyncNovu.environments();
    }
    /**
     * Creates an AsyncActivity sub-SDK bean if none exists.
     *
     * @param asyncNovu the async SDK instance
     * @return A configured AsyncActivity instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncActivity asyncActivity(AsyncNovu asyncNovu) {
        return asyncNovu.activity();
    }
    /**
     * Creates an AsyncLayouts sub-SDK bean if none exists.
     *
     * @param asyncNovu the async SDK instance
     * @return A configured AsyncLayouts instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncLayouts asyncLayouts(AsyncNovu asyncNovu) {
        return asyncNovu.layouts();
    }
    /**
     * Creates an AsyncSubscribers sub-SDK bean if none exists.
     *
     * @param asyncNovu the async SDK instance
     * @return A configured AsyncSubscribers instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncSubscribers asyncSubscribers(AsyncNovu asyncNovu) {
        return asyncNovu.subscribers();
    }
    /**
     * Creates an AsyncSubscribersPreferences sub-SDK bean if none exists.
     *
     * @param asyncNovu the async SDK instance
     * @return A configured AsyncSubscribersPreferences instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncSubscribersPreferences asyncSubscribersPreferences(AsyncNovu asyncNovu) {
        return asyncNovu.subscribersPreferences();
    }
    /**
     * Creates an AsyncTopics sub-SDK bean if none exists.
     *
     * @param asyncNovu the async SDK instance
     * @return A configured AsyncTopics instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncTopics asyncTopics(AsyncNovu asyncNovu) {
        return asyncNovu.topics();
    }
    /**
     * Creates an AsyncTopicsSubscriptions sub-SDK bean if none exists.
     *
     * @param asyncNovu the async SDK instance
     * @return A configured AsyncTopicsSubscriptions instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncTopicsSubscriptions asyncTopicsSubscriptions(AsyncNovu asyncNovu) {
        return asyncNovu.topicsSubscriptions();
    }
    /**
     * Creates an AsyncTranslations sub-SDK bean if none exists.
     *
     * @param asyncNovu the async SDK instance
     * @return A configured AsyncTranslations instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncTranslations asyncTranslations(AsyncNovu asyncNovu) {
        return asyncNovu.translations();
    }
    /**
     * Creates an AsyncTranslationsMaster sub-SDK bean if none exists.
     *
     * @param asyncNovu the async SDK instance
     * @return A configured AsyncTranslationsMaster instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncTranslationsMaster asyncTranslationsMaster(AsyncNovu asyncNovu) {
        return asyncNovu.translationsMaster();
    }
    /**
     * Creates an AsyncWorkflows sub-SDK bean if none exists.
     *
     * @param asyncNovu the async SDK instance
     * @return A configured AsyncWorkflows instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncWorkflows asyncWorkflows(AsyncNovu asyncNovu) {
        return asyncNovu.workflows();
    }
    /**
     * Creates an AsyncChannelConnections sub-SDK bean if none exists.
     *
     * @param asyncNovu the async SDK instance
     * @return A configured AsyncChannelConnections instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncChannelConnections asyncChannelConnections(AsyncNovu asyncNovu) {
        return asyncNovu.channelConnections();
    }
    /**
     * Creates an AsyncChannelEndpoints sub-SDK bean if none exists.
     *
     * @param asyncNovu the async SDK instance
     * @return A configured AsyncChannelEndpoints instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncChannelEndpoints asyncChannelEndpoints(AsyncNovu asyncNovu) {
        return asyncNovu.channelEndpoints();
    }
    /**
     * Creates an AsyncIntegrations sub-SDK bean if none exists.
     *
     * @param asyncNovu the async SDK instance
     * @return A configured AsyncIntegrations instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncIntegrations asyncIntegrations(AsyncNovu asyncNovu) {
        return asyncNovu.integrations();
    }
    /**
     * Creates an AsyncMessages sub-SDK bean if none exists.
     *
     * @param asyncNovu the async SDK instance
     * @return A configured AsyncMessages instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncMessages asyncMessages(AsyncNovu asyncNovu) {
        return asyncNovu.messages();
    }
    /**
     * Creates an AsyncNotifications sub-SDK bean if none exists.
     *
     * @param asyncNovu the async SDK instance
     * @return A configured AsyncNotifications instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncNotifications asyncNotifications(AsyncNovu asyncNovu) {
        return asyncNovu.notifications();
    }
    /**
     * Creates an AsyncSubscribersMessages1 sub-SDK bean if none exists.
     *
     * @param asyncNovu the async SDK instance
     * @return A configured AsyncSubscribersMessages1 instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncSubscribersMessages1 asyncSubscribersMessages1(AsyncNovu asyncNovu) {
        return asyncNovu.subscribersMessages();
    }
    /**
     * Creates an AsyncSubscribersNotifications sub-SDK bean if none exists.
     *
     * @param asyncNovu the async SDK instance
     * @return A configured AsyncSubscribersNotifications instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncSubscribersNotifications asyncSubscribersNotifications(AsyncNovu asyncNovu) {
        return asyncNovu.subscribersNotifications();
    }
}